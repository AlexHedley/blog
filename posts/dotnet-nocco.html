<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Nocco is a quick-and-dirty, literate-programming-style documentation generator">
    <meta name="author" content="AlexHedley">

  <title>Alex Hedley - .NET nocco</title>

  <link rel="canonical" href='https://alexhedley.github.io/blog/posts/dotnet-nocco'>

      <link type="application/rss+xml" rel="alternate" title="Alex Hedley" href="/blog/feed.rss" />
      <link type="application/atom+xml" rel="alternate" title="Alex Hedley" href="/blog/feed.atom" />

  <meta name="application-name" content='Alex Hedley' />
  <meta name="msapplication-tooltip" content='Alex Hedley' />
  <meta name="msapplication-starturl" content='/blog/' />

  <meta property="og:title" content='Alex Hedley - .NET nocco' />
    <meta property="og:image" content='/blog/posts/images/dotNET/dotNET.png' />
  <meta property="og:type" content="website" />
  <meta property="og:url" content='https://alexhedley.github.io/blog/posts/dotnet-nocco' />

  <link rel="icon" href='/blog/favicon.ico'>

  <!-- Custom fonts for this template -->
  <link href='/blog/vendor/fontawesome-free/css/all.min.css' rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" data-no-mirror>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" data-no-mirror>

  <!-- Styles for this template (also includes Bootstrap) -->
  <link href='/blog/scss/clean-blog.css' rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.3.0/dist/quicklink.umd.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.css" rel="stylesheet">

  <link href="/blog/scss/TabGroup.css" rel="stylesheet" type="text/css">

<link rel="stylesheet" href="../assets/css/override.css">

  

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href='/blog/'>Alex Hedley</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ms-auto">
          <li class="nav-item">
    <a class="nav-link" href="/blog/posts">Posts</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/blog/tags">Tags</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/blog/stats">Stats</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/blog/about">About</a>
  </li>

          <li class="nav-item">
            <span class="nav-link">
              <form class="form-inline my-2 my-lg-0" action="/blog/search" method="GET">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" name="query">
                <input type="submit" hidden />
              </form>
            </span>
          </li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->
  <header class="masthead" style="background-image: url(&quot;/blog/posts/images/dotNET/dotNET.png&quot;)">
  <div class="container position-relative">
    <div class="row">
      <div class="col-md-12">
        <div class='post-heading'>
          <h1>
            .NET nocco
          </h1>
            <span class="subheading">Updating nocco to .NET 9</span>
            <div class="meta">Published on Monday 12 May 2025</div>
              <div class="mt-3">
                  <a href="/blog/tags/programming" class="badge text-bg-light"> programming</a>
                  <a href="/blog/tags/dotnet" class="badge text-bg-light"> dotnet</a>
                  <a href="/blog/tags/csharp" class="badge text-bg-light"> csharp</a>
              </div>
        </div>
      </div>
    </div>
  </div>
    <div class="image-attribution badge text-bg-secondary rounded-pill"><p>https://neosmart.net/blog/new-dot-net-standard-framework-logo/</p>
</div>
</header>


  <!-- Main Content -->
  <div class="container">
    <div class="row">
      <div id="content" class="col-md-12">
        <!-- .NET nocco -->
<!-- ![.NET](images/dotNET/dotNET.png ".NET") -->
<p>In this post I will talk through how I updated Don Wilson's (<a href="https://github.com/dontangg">&#64;dontangg</a>) <strong>nocco</strong> from .NET Framework v4.0 to .NET (Core) v9.</p>
<p>So what is nocco? It's a .NET port of <a href="https://ashkenas.com/docco/">Docco</a>. What is Docco?</p>
<blockquote>
<p>Docco is a quick-and-dirty documentation generator, written in <a href="https://coffeescript.org/#literate">Literate CoffeeScript</a>. It produces an HTML document that displays your comments intermingled with your code. All prose is passed through <a href="http://daringfireball.net/projects/markdown/syntax">Markdown</a>, and code is passed through <a href="http://highlightjs.org/">Highlight.js</a> syntax highlighting. This page is the result of running Docco against its own <a href="https://github.com/jashkenas/docco/blob/master/docco.litcoffee">source file</a>.</p>
</blockquote>
<blockquote>
<p>Nocco is a quick-and-dirty, literate-programming-style</p>
</blockquote>
<p>You can see an original output of <code>nocco.cs</code> on <a href="http://donwilson.net/nocco/">http://donwilson.net/nocco/</a>.</p>
<p><img src="images/dotNET/nocco/nocco.cs.html.png" alt="nocco" title="nocco" /></p>
<p>What does it do? The original takes a list of files, these could be C#, VB.NET, SQL or JS and produces a side by side view of code comments and their respective code.</p>
<p>From the <code>nocco.cs</code> page at the Razor section their notes are the following:</p>
<blockquote>
<p>Setup the Razor templating engine so that we can quickly pass the data in and generate HTML.
The file <code>Resources\Nocco.cshtml</code> is read and compiled into a new dll with a type that extends the <code>TemplateBase</code> class. This new assembly is loaded so that we can create an instance and pass data into it and generate the HTML.</p>
</blockquote>
<p>This file was then executed to produce the output, along with the html documentation and syntax highlighted code, you can read more about it on the linked page or in the code itself.</p>
<p>I've got some experience with building DLLs using <code>Microsoft.CodeAnalysis.CSharp</code> when I built <a href="https://github.com/alex-hedley/BlazorInteractive">BlazorInteractive</a> but this has changed a little from the original <code>CSharpCodeProvider</code> used here.</p>
<p>For the first pass I thought it might be easier to not have the code be compiled in the same way, instead I'll just build a Razor page, like before, and then pass the data I needed. Luckily <a href="https://robanderson.dev/">Rob Anderson</a> had told me about a method he'd used to do this:</p>
<ul>
<li>Render Razor components outside of ASP.NET Core
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/components/render-components-outside-of-aspnetcore?view=aspnetcore-9.0">https://learn.microsoft.com/en-us/aspnet/core/blazor/components/render-components-outside-of-aspnetcore?view=aspnetcore-9.0</a></li>
</ul>
</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.components.web.htmlrenderer?view=aspnetcore-9.0"><code>HtmlRenderer</code></a> to the rescue.</p>
<p>I made the project use the SDK: <code>Microsoft.NET.Sdk.Razor</code> then added the <code>Microsoft.AspNetCore.Components.Web</code> library.</p>
<p>Next the <code>GenerateHtml()</code> method was where I got to work updating. Following the above tutorial was very quick. I renamed the original <code>Nocco.cshtml</code> to <code>Webpage.razor</code> and added in the corresponding <code>&#64;code {}</code> and <code>[Parameter]</code>s. This now allows me to pass a <code>Dictionary</code> of KVPs matching the Parameter names with the corresponding data types. It didn't like passing the <code>Func&lt;&gt;</code> directly as an <code>object?</code> so I made it it's own variable and passed that in.</p>
<p>Source: <a href="https://github.com/AlexHedley/nocco/blob/d6f7f65e519d66056db67f5c5430f8d9ee94da1a/src/Nocco/Nocco.cs#L116-L153">https://github.com/AlexHedley/nocco/blob/d6f7f65e519d66056db67f5c5430f8d9ee94da1a/src/Nocco/Nocco.cs#L116-L153</a></p>
<!-- https://raw.githubusercontent.com/AlexHedley/nocco/d6f7f65e519d66056db67f5c5430f8d9ee94da1a/src/Nocco/Nocco.cs -->
<details>
<summary>GenerateHtml</summary>
<pre><code class="language-cs">private static async void GenerateHtml(string source, List&lt;Section&gt; sections)
{
    int depth;
    var destination = GetDestination(source, out depth);
        
    string pathToRoot = string.Concat(Enumerable.Repeat(&quot;..&quot; + Path.DirectorySeparatorChar, depth));

    IServiceCollection services = new ServiceCollection();
    services.AddLogging();
    IServiceProvider serviceProvider = services.BuildServiceProvider();
    ILoggerFactory loggerFactory = serviceProvider.GetRequiredService&lt;ILoggerFactory&gt;();
    await using var htmlRenderer = new HtmlRenderer(serviceProvider, loggerFactory);

    var html = await htmlRenderer.Dispatcher.InvokeAsync(async () =&gt;
    {
        Func&lt;string, string&gt; getSourcePath = s =&gt;
            Path.Combine(pathToRoot, Path.ChangeExtension(s.ToLower(), &quot;.html&quot;).Substring(2)).Replace('\\', '/');
        var dictionary = new Dictionary&lt;string, object?&gt;
        {
            { &quot;Title&quot;, Path.GetFileName(source) },
            { &quot;PathToCss&quot;, Path.Combine(pathToRoot, &quot;nocco.css&quot;).Replace('\\', '/') },
            { &quot;PathToJs&quot;, Path.Combine(pathToRoot, &quot;prettify.js&quot;).Replace('\\', '/') },
            { &quot;GetSourcePath&quot;, getSourcePath },
            { &quot;Sections&quot;, sections },
            { &quot;Sources&quot;, _files },
        };

        var parameters = ParameterView.FromDictionary(dictionary);
        var output = await htmlRenderer.RenderComponentAsync&lt;Webpage&gt;(parameters);

        return output.ToHtmlString();
    });
    
    File.WriteAllText(destination, html);
}
</code></pre>
</details>
<p>Build the app.</p>
<p>Navigate to the folder with your source files in</p>
<p><code>nocco *.cs</code></p>
<p>Open the newly created <code>docs</code> folder and open any of the matching <code>*.html</code> files.</p>
<h3 id="dependencies">Dependencies</h3>
<p>The original also used <a href="https://www.nuget.org/packages/MarkdownSharp/1.13.0">MarkdownSharp</a> <em>v1.13.0.0</em>, I updated this to <a href="https://www.nuget.org/packages/MarkdownSharpCore">MarkdownSharpCore</a> <em>v1.2.0</em> just to make the upgrade easier, I'm contemplating swapping to <a href="https://www.nuget.org/packages/MarkDig">Markdig</a>.</p>
<h2 id="code">&lt;/&gt; Code</h2>
<ul>
<li><a href="https://github.com/AlexHedley/nocco">https://github.com/AlexHedley/nocco</a></li>
<li><a href="https://github.com/AlexHedley/nocco-example">https://github.com/AlexHedley/nocco-example</a></li>
</ul>
<h2 id="links">🔗 Links</h2>
<ul>
<li><a href="https://github.com/dontangg/nocco">https://github.com/dontangg/nocco</a>
<ul>
<li><a href="http://donwilson.net/nocco/">http://donwilson.net/nocco/</a></li>
</ul>
</li>
<li><a href="https://ashkenas.com/docco/">https://ashkenas.com/docco/</a></li>
</ul>


        

      </div>
    </div>
  <div id="comments-container" class="row">
    <script src="https://giscus.app/client.js"
        data-repo='alexhedley/blog'
        data-repo-id='R_kgDOJjXJmQ'
        data-category-id='DIC_kwDOJjXJmc4CXRaX'
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

  </div>
  </div>

  <hr>

  <!-- Footer -->
  <footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12 text-center">
        <p class="copyright">Copyright &#xA9; 2025</p>

        <ul class="list-inline text-center small">
            <li class="list-inline-item">
              <a href="/blog/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a>
            </li>
            <li class="list-inline-item">
              <a href="/blog/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
            </li>
        </ul>
        <br />
        <div class="font-weight-bold small"><a href="https://statiq.dev">Generated by Statiq</a></div>
      </div>
    </div>
  </div>
</footer>


  <!-- Scripts -->
  <script src='/blog/vendor/bootstrap/js/bootstrap.bundle.min.js'></script>
  <script src='/blog/vendor/startbootstrap-clean-blog/js/scripts.js'></script>
  <script src='/blog/js/clean-blog.js'></script>
      <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CQV2ZWNX32"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-CQV2ZWNX32');
    </script>

    <!-- Mermaid -->
    <script src="https://unpkg.com/mermaid@8.9.3/dist/mermaid.min.js" integrity="sha384-nVmn6yKHyUktDHdQfBgpn1YPgEu8gDXTYI5qccfkF1j6oxBHjKEafySIuNs3UhEW" crossorigin="anonymous"></script>
  

</body>

</html>
